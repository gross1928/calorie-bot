# План работ: Telegram-бот «Счётчик калорий»

## Этап 1: Рефакторинг и устранение дублирования (Задача 4)

- [ ] Проанализировать `bot.js` на наличие дублирующихся функций (например, `recognizeFood`, `generate...Plan`, обработчики состояний).
- [ ] Проанализировать `bot.js` на наличие дублирующихся или пересекающихся переменных и констант.
- [ ] Объединить или удалить найденные дубликаты, обеспечив сохранение функциональности.
- [ ] Проверить, что после изменений основные сценарии (добавление еды, запрос плана) работают корректно.

## Этап 2: Улучшение UX при обработке фото (Задача 2)

- [ ] Найти обработчик callback-а, который сейчас показывает отчёт по фото.
- [ ] Удалить кнопку «Не сохранять».
- [ ] Добавить кнопки «Изменить граммы» и «Изменить ингредиенты».
- [ ] Реализовать новый callback-обработчик для кнопки «Изменить граммы», который показывает клавиатуру (`-100г`, `-50г`, `+50г`, `+100г`).
- [ ] Реализовать логику пересчёта КБЖУ и обновления сообщения при нажатии на кнопки изменения граммов.
- [ ] Реализовать логику для кнопки «Изменить ингредиенты»: запрос нового списка и пересчёт КБЖУ.

## Этап 3: Визуальное оформление планов (Задача 1)

- [ ] Найти функции `generateWorkoutPlanHTML` и `generateNutritionPlanHTML`.
- [ ] Модифицировать их, чтобы они возвращали не HTML-строку для файла, а текст, отформатированный с помощью `MarkdownV2` или `HTML` для `sendMessage`.
- [ ] Использовать в форматировании полужирный, курсивный и моноширинный шрифты для создания "красивого" сообщения.
- [ ] Заменить вызовы `sendPlanAsDocument` на `smartSendMessage` с новым форматированным текстом.

## Этап 4: Улучшение логики ИИ (Задача 3)

- [ ] Найти все функции, где ИИ может самостоятельно вносить данные (`processUniversalMessage`, `processVoiceMessage`).
- [ ] Добавить к сообщениям о таких изменениях inline-кнопку «Не сохранять» или «Отменить».
- [ ] Реализовать обработчик для этой кнопки, который будет удалять последнюю сделанную ИИ запись.
- [ ] Проанализировать и доработать промпт для `processUniversalMessage`, чтобы научить модель распознавать и обрабатывать несколько разных запросов в одном сообщении (например, "выпил воды и сделал зарядку").



